{
	"name": "DF_Cleanse",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "DS_Raw_FilePath_Json",
						"type": "DatasetReference"
					},
					"name": "JSONRaw"
				}
			],
			"sinks": [
				{
					"linkedService": {
						"referenceName": "datalake",
						"type": "LinkedServiceReference"
					},
					"name": "sinkToCSV",
					"rejectedDataLinkedService": {
						"referenceName": "datalake",
						"type": "LinkedServiceReference"
					}
				}
			],
			"transformations": [
				{
					"name": "mapJSONHierarchySubcolumns"
				},
				{
					"name": "select1"
				},
				{
					"name": "derivedColumn1"
				}
			],
			"scriptLines": [
				"parameters{",
				"     SinkFolder as string,",
				"     FileName as string",
				"}",
				"source(output(",
				"          attributes as (employment_status as (label as string, name as string, type as string), interests as (label as string, name as string, type as string), state as (label as string, name as string, type as string)),",
				"          nice as (address as string, address_oneline as string, age as short, available_by_default as boolean, background_check_user as string[], delete_requested as boolean, duplicate_status as string, email_verified as boolean, employment_status as string, first_name as string, given_names as string, google2fa_enabled as boolean, info as string, interests as string, {interests:array} as string, {interests:value} as string, is_subscribed as boolean, is_team_leader as boolean, last_name as string, login_locked as boolean, middle_name as string, name as string, phone as string, {phone:raw} as long, picture_status as string, preferred_first_name as string, preferred_name as string, rrn as string, shift_privacy as boolean, state as string, team_member_id as string, terms as boolean, updated_hours as short),",
				"          object as (account_id as short, address as (city as string, coordinates as (latitude as double, longitude as double), country as string, iso as string, latitude as double, longitude as double, postcode as short, region as string, street_address_1 as string, street_address_2 as string, street_address_3 as string), created_at as string, delete_requested_at as string, deleted_at as string, deleted_by as string, dob as date, email as string, email_verified as boolean, employment_status as string, first_name as string, id as integer, id_token as string, interests as string, is_subscribed as boolean, is_team_leader as boolean, is_unreachable as boolean, last_login_at as timestamp, last_name as string, login_lockout_at as string, login_lockout_attempts as short, login_lockout_email_sent_at as string, middle_name as string, phone as string, picture as string, picture_status as boolean, preferred_name as string, rating as double, shift_privacy as boolean, state as string, team_member_id as string, terms as boolean, updated_at as string, verify_email_token as string),",
				"          permissions as (delete as boolean, impersonate as boolean, read as boolean, update as boolean),",
				"          relations as string[]",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false,",
				"     documentForm: 'documentPerLine',",
				"     backslashEscape: true) ~> JSONRaw",
				"JSONRaw select(mapColumn(",
				"          each(nice,match(1==1),",
				"               lower($$) = $$),",
				"          each(object,match(1==1),",
				"               lower($$) = $$)",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> mapJSONHierarchySubcolumns",
				"derivedColumn1 select(mapColumn(",
				"          object_created_at,",
				"          object_delete_requested_at,",
				"          object_deleted_at,",
				"          object_deleted_by,",
				"          object_dob,",
				"          object_email,",
				"          object_email_verified,",
				"          object_employment_status,",
				"          object_first_name,",
				"          object_id,",
				"          object_interests,",
				"          object_is_subscribed,",
				"          object_is_team_leader,",
				"          object_is_unreachable,",
				"          object_last_login_at,",
				"          object_last_name,",
				"          object_login_lockout_at,",
				"          object_login_lockout_attempts,",
				"          object_login_lockout_email_sent_at,",
				"          object_middle_name,",
				"          object_phone,",
				"          object_picture,",
				"          object_picture_status,",
				"          object_preferred_name,",
				"          object_rating,",
				"          object_shift_privacy,",
				"          object_state,",
				"          object_team_member_id,",
				"          object_terms,",
				"          object_updated_at,",
				"          object_verify_email_token,",
				"          nice_address,",
				"          nice_address_oneline,",
				"          nice_age,",
				"          nice_available_by_default,",
				"          nice_background_check_user,",
				"          nice_delete_requested,",
				"          nice_duplicate_status,",
				"          nice_email_verified,",
				"          nice_employment_status,",
				"          nice_first_name,",
				"          nice_given_names,",
				"          nice_google2fa_enabled,",
				"          nice_info,",
				"          nice_interests,",
				"          {nice_interests:array},",
				"          {nice_interests:value},",
				"          nice_is_subscribed,",
				"          nice_is_team_leader,",
				"          nice_last_name,",
				"          nice_login_locked,",
				"          nice_middle_name,",
				"          nice_name,",
				"          nice_phone,",
				"          {nice_phone:raw},",
				"          nice_picture_status,",
				"          nice_preferred_first_name,",
				"          nice_preferred_name,",
				"          nice_rrn,",
				"          nice_shift_privacy,",
				"          nice_state,",
				"          nice_team_member_id,",
				"          nice_terms,",
				"          nice_updated_hours,",
				"          permissions_delete,",
				"          permissions_impersonate,",
				"          permissions_read,",
				"          permissions_update,",
				"          attributes_employment_status_label,",
				"          attributes_employment_status_name,",
				"          attributes_employment_status_type,",
				"          attributes_employment_state_label,",
				"          attributes_employment_state_name,",
				"          attributes_employment_state_type,",
				"          object_address_city,",
				"          object_address_country,",
				"          object_address_iso,",
				"          object_address_latitude,",
				"          object_address_longitude,",
				"          object_address_postcode,",
				"          object_address_region,",
				"          object_address_street_address_1,",
				"          object_address_street_address_2,",
				"          object_address_street_address_3,",
				"          {1=1}",
				"     ),",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> select1",
				"mapJSONHierarchySubcolumns derive(each(nice, match(true())),",
				"          {$$} = $$) ~> derivedColumn1",
				"select1 sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     format: 'delimited',",
				"     fileSystem: 'cleansed',",
				"     folderPath: ($SinkFolder),",
				"     columnDelimiter: ',',",
				"     escapeChar: '\\\\',",
				"     quoteChar: '\\\"',",
				"     columnNamesAsHeader: true,",
				"     umask: 0022,",
				"     preCommands: [],",
				"     postCommands: [],",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> sinkToCSV"
			]
		}
	}
}