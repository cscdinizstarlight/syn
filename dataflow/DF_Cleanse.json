{
	"name": "DF_Cleanse",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "DS_Raw_FolderPath_Json",
						"type": "DatasetReference"
					},
					"name": "JSONRaw"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "DS_Cleansed_Rosterfy_User",
						"type": "DatasetReference"
					},
					"name": "sinkToCSV"
				}
			],
			"transformations": [
				{
					"name": "replaceNewlineChar"
				},
				{
					"name": "mapJSONHierarchySubcolumns"
				}
			],
			"scriptLines": [
				"parameters{",
				"     SinkFolder as string",
				"}",
				"source(output(",
				"          object as (id as integer, id_token as string, email as string, first_name as string, middle_name as string, last_name as string, preferred_name as string, phone as string, dob as string, picture as string, picture_status as integer, is_subscribed as integer, is_unreachable as integer, terms as integer, rating as string, shift_privacy as integer, is_team_leader as integer, email_verified as integer, verify_email_token as string, login_lockout_attempts as integer, login_lockout_at as string, login_lockout_email_sent_at as string, last_login_at as string, delete_requested_at as string, deleted_at as string, created_at as string, updated_at as string, team_member_id as string, state as string, employment_status as string, address as (iso as string, coordinates as (latitude as string, longitude as string), street_address_1 as string, street_address_2 as string, street_address_3 as string, city as string, postcode as string, region as string, country as string, latitude as string, longitude as string)),",
				"          nice as (rrn as string, email_verified as string, first_name as string, is_subscribed as string, is_team_leader as string, last_name as string, middle_name as string, phone as string, {phone:raw} as string, preferred_name as string, shift_privacy as string, terms as string, employment_status as string, state as string, team_member_id as string, name as string, age as integer, address as string, address_oneline as string, info as string, background_check_user as string[], preferred_first_name as string, available_by_default as boolean, google2fa_enabled as boolean, picture_status as string, delete_requested as boolean, updated_hours as integer, login_locked as boolean, duplicate_status as string),",
				"          relations as string[],",
				"          permissions as (read as boolean, update as boolean, delete as boolean, impersonate as boolean),",
				"          attributes as (employment_status as (name as string, label as string, type as string), state as (name as string, label as string, type as string))",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false,",
				"     documentForm: 'documentPerLine',",
				"     backslashEscape: true) ~> JSONRaw",
				"mapJSONHierarchySubcolumns derive(nice_address = replace(nice_address, \"\\n\", \" \")) ~> replaceNewlineChar",
				"JSONRaw select(skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> mapJSONHierarchySubcolumns",
				"replaceNewlineChar sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     input(",
				"          object_id as string,",
				"          object_id_token as string,",
				"          object_email as string,",
				"          object_first_name as string,",
				"          object_middle_name as string,",
				"          object_last_name as string,",
				"          object_preferred_name as string,",
				"          object_phone as string,",
				"          object_dob as string,",
				"          object_picture as string,",
				"          object_picture_status as string,",
				"          object_is_subscribed as string,",
				"          object_is_unreachable as string,",
				"          object_terms as string,",
				"          object_rating as string,",
				"          object_shift_privacy as string,",
				"          object_is_team_leader as string,",
				"          object_email_verified as string,",
				"          object_verify_email_token as string,",
				"          object_login_lockout_attempts as string,",
				"          object_login_lockout_at as string,",
				"          object_login_lockout_email_sent_at as string,",
				"          object_last_login_at as string,",
				"          object_delete_requested_at as string,",
				"          object_deleted_at as string,",
				"          object_created_at as string,",
				"          object_updated_at as string,",
				"          object_team_member_id as string,",
				"          object_state as string,",
				"          object_employment_status as string,",
				"          object_address as string,",
				"          nice_rrn as string,",
				"          nice_email_verified as string,",
				"          nice_first_name as string,",
				"          nice_is_subscribed as string,",
				"          nice_is_team_leader as string,",
				"          nice_last_name as string,",
				"          nice_middle_name as string,",
				"          nice_phone as string,",
				"          {nice_phone:raw} as string,",
				"          nice_preferred_name as string,",
				"          nice_shift_privacy as string,",
				"          nice_terms as string,",
				"          nice_employment_status as string,",
				"          nice_state as string,",
				"          nice_team_member_id as string,",
				"          nice_name as string,",
				"          nice_age as string,",
				"          nice_address as string,",
				"          nice_address_oneline as string,",
				"          nice_info as string,",
				"          nice_background_check_user as string,",
				"          nice_preferred_first_name as string,",
				"          nice_available_by_default as string,",
				"          nice_google2fa_enabled as string,",
				"          nice_picture_status as string,",
				"          nice_delete_requested as string,",
				"          nice_updated_hours as string,",
				"          nice_login_locked as string,",
				"          nice_duplicate_status as string,",
				"          permissions_read as string,",
				"          permissions_update as string,",
				"          permissions_delete as string,",
				"          permissions_impersonate as string,",
				"          attributes_employment_status_name as string,",
				"          attributes_employment_status_label as string,",
				"          attributes_employment_status_type as string,",
				"          attributes_employment_state_name as string,",
				"          attributes_employment_state_label as string,",
				"          attributes_employment_state_type as string,",
				"          object_address_iso as string,",
				"          object_address_coordinates as string,",
				"          object_address_street_address_1 as string,",
				"          object_address_street_address_2 as string,",
				"          object_address_street_address_3 as string,",
				"          object_address_city as string,",
				"          object_address_postcode as string,",
				"          object_address_region as string,",
				"          object_address_country as string,",
				"          object_address_latitude as string,",
				"          object_address_longitude as string,",
				"          object_address_coordinates_latitude as string,",
				"          object_address_coordinates_longitude as string",
				"     ),",
				"     umask: 0022,",
				"     preCommands: [],",
				"     postCommands: [],",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true) ~> sinkToCSV"
			]
		}
	}
}