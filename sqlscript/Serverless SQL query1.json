{
	"name": "Serverless SQL query1",
	"properties": {
		"folder": {
			"name": "SQL Serverless"
		},
		"content": {
			"query": "--DROP DATABASE logicalDW;\n\nCREATE DATABASE logicalDW COLLATE Latin1_General_100_BIN2_UTF8;\n\nUSE logicalDW;\nGO\n\nCREATE MASTER KEY ENCRYPTION BY PASSWORD = '2A4iTR622$Aa29M*5s!LDouT8Fd^WtkE';\n\nCREATE DATABASE SCOPED CREDENTIAL WorkspaceIdentity\nWITH IDENTITY = 'Managed Identity';\nGO\nCREATE EXTERNAL DATA SOURCE ExtDSCurated WITH (\n    LOCATION = 'https://stldatalakedev.dfs.core.windows.net/curated/',\n    CREDENTIAL = WorkspaceIdentity\n);\n\nCREATE EXTERNAL FILE FORMAT ParquetFormat WITH (  FORMAT_TYPE = PARQUET );\n\nselect top 10 *\nfrom openrowset(bulk 'Rosterfy/*.parquet',\n                data_source = 'ExtDSCurated',\n                format='parquet') as a\n;\n\nCREATE SCHEMA LDW;\n\n-- prepare view for Rosterfy User\nDROP VIEW IF EXISTS LDW.vwRosterfyUser;\nGO\n\nCREATE VIEW LDW.vwRosterfyUser AS\nSELECT\n    *\nFROM\n    OPENROWSET(\n        --BULK 'Rosterfy/RosterfyUser.parquet',\n        BULK 'Rosterfy/User/*.parquet',\n        DATA_SOURCE = 'ExtDSCurated',\n        FORMAT='PARQUET'\n    ) AS vwRU;\n\nselect top 20 * from LDW.vwRosterfyUser;\n\n-- prepare view for Rosterfy BookedShift\nDROP VIEW IF EXISTS LDW.vwRosterfyBookedShift;\nGO\n\nCREATE VIEW LDW.vwRosterfyBookedShift AS\nSELECT\n    *\nFROM\n    OPENROWSET(\n        --BULK 'Rosterfy/RosterfyBookedShift.parquet',\n        BULK 'Rosterfy/BookedShift/*.parquet',\n        DATA_SOURCE = 'ExtDSCurated',\n        FORMAT='PARQUET'\n    ) AS vwRBS;\n\nselect top 20 * from LDW.vwRosterfyBookedShift;\n\n-- prepare view for Rosterfy Shift\nDROP VIEW IF EXISTS LDW.vwRosterfyShift;\nGO\n\nCREATE VIEW LDW.vwRosterfyShift AS\nSELECT\n    *\nFROM\n    OPENROWSET(\n        BULK 'Rosterfy/Shift/*.parquet',\n        DATA_SOURCE = 'ExtDSCurated',\n        FORMAT='PARQUET'\n    ) AS vwRBS;\n\nselect top 20 * from LDW.vwRosterfyShift;\n\n-- prepare view for Rosterfy Event\nDROP VIEW IF EXISTS LDW.vwRosterfyEvent;\nGO\n\nCREATE VIEW LDW.vwRosterfyEvent AS\nSELECT\n    *\nFROM\n    OPENROWSET(        \n        BULK 'Rosterfy/Event/*.parquet',\n        DATA_SOURCE = 'ExtDSCurated',\n        FORMAT='PARQUET'\n    ) AS vwRos;\n\nselect top 20 * from LDW.vwRosterfyEvent;\n\n\ndrop EXTERNAL table [LDW].[RosterfyUserCETAS];\n\nCREATE EXTERNAL TABLE [LDW].[RosterfyUserCETAS] WITH (\n        LOCATION = 'Rosterfy/User/UserParquet',\n        DATA_SOURCE = ExtDSCurated,\n        FILE_FORMAT = ParquetFormat\n) AS\nSELECT *\nFROM\n    OPENROWSET(\n        BULK 'Rosterfy/RosterfyUser.parquet',\n        DATA_SOURCE = 'ExtDSCurated',\n        FORMAT = 'PARQUET'\n    )  AS r;\n\nselect top 100 *\nfrom openrowset(bulk 'Rosterfy/User/UserParquet/*.parquet',\n                data_source = 'ExtDSCurated',\n                format='parquet') as b\n;\n\n\nSELECT max(SurrogateKey) FROM LDW.vwRosterfyUser\n;\n\nselect * \nfrom openrowset(bulk 'Rosterfy/User/*.parquet',\n                data_source = 'ExtDSCurated',\n                format='parquet') as a\n                \n;\n\nSELECT max(SurrogateKey) AS maxSurrogateKey FROM LDW.vwRosterfyUser;\n\nSELECT * FROM LDW.vwRosterfyUser;\n\nselect max(SurrogateKey) as maxSK\nfrom openrowset(bulk 'Rosterfy/part*.parquet',\n                data_source = 'ExtDSCurated',\n                format='parquet') as a\n;\n\n\nSELECT \nRANK() OVER (PARTITION by id ORDER BY InsertedOn DESC) as isCurrent\n,SurrogateKey \n,id\n,email\n,object_first_name\n,InsertedOn\nFROM [LDW].[vwRosterfyUser]\n;\n\n\n\nCREATE EXTERNAL TABLE [LDW].[extRosterfyUserNEW1] WITH (\n        LOCATION = 'Rosterfy/CETAS/UserNEW1',\n        DATA_SOURCE = ExtDSCurated,\n        FILE_FORMAT = ParquetFormat\n) AS\nSELECT\n    *\nFROM\n(\n    SELECT\n    RANK() OVER (PARTITION by id ORDER BY InsertedOn DESC) as isCurrent\n     --, *\n    ,id\n    ,email\n    ,object_first_name\n    ,object_last_name\n    ,object_team_member_id\n    ,object_employment_status\n    ,object_state\n    ,nice_name\n    ,updated_hours\n    ,created_at\n    ,updated_at\n\n    FROM \n    OPENROWSET(\n        BULK 'Rosterfy/User/*.parquet',\n        DATA_SOURCE = 'ExtDSCurated',\n        FORMAT = 'PARQUET'\n    )  AS r\n) AS t\nWHERE isCurrent = 1\n;\n\nSELECT top 20 * FROM [LDW].[vwRosterfyUser]\nWHERE object_first_name = 'Gavin';\n--where InsertedOn='2022-03-17T23:25:39.8930000';\n\nDROP EXTERNAL TABLE [LDW].[extRosterfyUser];\n\n\nselect count(*) as cnt from [LDW].[extRosterfyUserNEW1];\n\nselect *\nfrom [LDW].[extRosterfyUserNEW1]\norder by created_at DESC;\n\nselect * \nfrom (\nSELECT \nRANK() OVER (PARTITION by id ORDER BY InsertedOn DESC) as isCurrent\n,SurrogateKey \n,id\n,email\n,object_first_name\n,rowHash\n,InsertedOn\nFROM [LDW].[vwRosterfyUser]\n) as t\nwhere isCurrent = 1\n;\n\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "logicalDW",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}